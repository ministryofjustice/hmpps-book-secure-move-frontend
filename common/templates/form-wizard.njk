{% extends "layouts/two-column.njk" %}

{% set additionalContainerClass = "sticky-sidebar-container" %}

{% block pageTitle %}
  {%- if errors.errorList.length -%}
  {{ t("validation::page_title_prefix") }}:
  {%- endif %}
  {% block innerPageTitle %}
    {{ t(options.pageTitle) }} - {{ t(options.journeyPageTitle) }}
  {% endblock %}
{% endblock %}

{% block beforeContent %}
  {{ super() }}

  {% if backLink %}
    {{ govukBackLink({
      text: t("actions::back"),
      href: backLink
    }) }}
  {% endif %}
{% endblock %}

{% block contentHeader %}
  {% set govukErrorSummaryClasses = ["js-error-summary"].concat("app-hidden" if errors.errorList.length == 0) | join(" ") %}

  {{ govukErrorSummary({
    titleText: t("validation::summary.heading"),
    errorList: errors.errorList,
    classes: govukErrorSummaryClasses
  }) }}

  <header class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <h1 class="govuk-heading-xl">
        {{ t(options.pageTitle) }}
      </h1>
    </div>
  </header>
{% endblock %}

{% block contentMain %}
  {% set formMethod = options.method | default('post') %}
  {% set formAction = options.action | default('') %}
  {% set formEnctype = options.enctype | default('') %}

  <form method="{{ formMethod }}" action="{{ formAction }}"
  {% if formEnctype %}
    enctype="{{ formEnctype }}"
  {% endif %}
  >

    {% if formMethod == 'post' %}
      <input type="hidden" name="x-csrf-token" value="{{ getLocal('csrf-token') }}">
    {% endif %}

    {% block beforeFields %}{% endblock %}

    {% block fields %}
      {% for key, fieldsOptions in options.fields %}
        {% if fieldsOptions.component and not fieldsOptions.skip %}
          {{ callAsMacro(fieldsOptions.component)(fieldsOptions) }}
        {% endif %}
      {% endfor %}
    {% endblock %}

    {% block formActions %}
      {{ govukButton({
        text: t(options.buttonText or "actions::continue"),
        classes: options.buttonClasses
      }) }}

      {% if cancelUrl and canAccess("move:delete") %}
        {% if formMethod == 'get' %}
            <a href="{{ cancelUrl }}" class="govuk-button govuk-button--text">
              {{ t("actions::cancel") }}
            </a>
          {% else %}
            {{ govukButton({
              text: t("actions::cancel"),
              classes: "govuk-button govuk-button--text",
              name: "cancel_move",
              value: "cancel"
            }) }}
        {% endif %}
      {% endif %}
    {% endblock %}
  </form>

{% endblock %}

{% block contentSidebar %}
  {% if person %}
    <div class="sticky-sidebar">
      <div class="sticky-sidebar__inner">
        <h3 class="govuk-heading-m app-border-top-2 app-border--blue govuk-!-padding-top-4">
          {{ person.fullname | upper }}
        </h3>

        {{ appMetaList(moveSummary) }}
      </div>
    </div>
  {% endif %}
{% endblock %}
